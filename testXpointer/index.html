<!DOCTYPE html>
<html>
    <head>
        <title> test </title>
        <script src="http://code.jquery.com/jquery-latest.js"></script>
        <link rel="stylesheet" media="screen" href="main.css">
        <link rel="stylesheet" media="screen" href="bootstrap.css">
        <script src="jquery.contextMenu.js" type="text/javascript"></script>
        <link href="jquery.contextMenu.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <div class="container">
            <h1>TwitchTV : Le petit dernier qui monte</h1>
            <!--
            <p><a href="http://www.jeuxvideo.com/screenshots/dossiers/images/00017381/00017381_00000006_000.htm" target="_blank"><img width="172" src="http://image.jeuxvideo.com/imd/t/twitch_logo-1_m.jpg" alt="" class="img_left" /></a>Justin.tv, la plate-forme g&#233;n&#233;raliste, s'est rapidement rendue &#224; l'&#233;vidence&#160;: les <span class="lexique gamers">gamers</span> formaient une grosse partie des diffuseurs et des spectateurs. Devant ce constat, la compagnie a d&#233;cid&#233; de cr&#233;er un site sp&#233;cifique pour cette communaut&#233;&#160;: ce sera TwitchTV, lanc&#233; en juin 2011. Fort du soutien de sa maison-m&#232;re et de ses cinq ann&#233;es d'exp&#233;rience dans le <span class="lexique streaming">streaming</span> live, Twitch s'est rapidement impos&#233; comme la plate-forme incontournable du secteur. Marchant sur les plates-bandes d'own3D.tv, Twitch a nou&#233; des partenariats avec plusieurs ligues <span class="lexique e_sport">e-sport</span> (Major League Gaming, Electronic Sports League...) pour diffuser leurs comp&#233;titions sur le Web. Le site a par exemple &#233;t&#233; choisi pour couvrir l'Evo Championship Series 2012, le grand tournoi annuel d&#233;di&#233; aux jeux de baston. Et quand le g&#233;ant de l'information vid&#233;oludique Gamespot a d&#233;cid&#233; d'int&#233;grer des livestreams en avril 2012, c'est tout naturellement vers Twitch qu'il s'est tourn&#233;. Bref, <strong>en &#224; peine plus d'une ann&#233;e d'existence, TwitchTV s'est impos&#233; comme un acteur incontournable de la diffusion d'e-sport en direct</strong>.</p>
            <p><a href="http://www.jeuxvideo.com/screenshots/dossiers/images/00017381/00017381_00000003_000.htm" target="_blank"><img src="http://image.jeuxvideo.com/imd/y/youtube_logo-1_m.jpg" alt="" class="img_left" width="172"></a>Dans les années 2000, la généralisation des connexions à haut débit et le progrès des technologies d'encodage ont généré l'explosion du contenu vidéo sur le Web, auparavant cantonné à du texte et de l'image. Des géants tels que YouTube et Dailymotion sont apparus, permettant à tout un chacun de partager ou visionner des vidéos. Néanmoins, <strong>ces gros sites de streaming ont raté le coche du direct</strong>. Après quelques expérimentations ponctuelles, comme le show YouTube Live en 2008 et un concert de U2 en 2009, le leader du marché, propriété de Google, n'a officiellement lancé sa plate-forme de <span class="lexique streaming actif">streaming</span> en direct qu'en avril 2011&nbsp;! Et encore, elle est réservée aux utilisateurs dits "Partenaires" et reste inaccessible à monsieur Tout-le-monde (sauf pour le visionnage, cela va de soi). Même chose chez Dailymotion, qui a lancé son service en mai 2011 après quelques retransmissions l'année précédente, et qui réserve la fonctionnalité à ses "Official Users". <strong>Les conditions étaient donc réunies pour qu'émergent de nouveaux acteurs spécialisés dans le streaming live</strong>. Nous allons en voir quelques-uns en détail, mais la liste n'est pas exhaustive.</p>
            <p><a href="http://www.jeuxvideo.com/screenshots/dossiers/images/00017381/00017381_00000004_000.htm" target="_blank"><img src="http://image.jeuxvideo.com/imd/j/justintv_logo-2_m.jpg" alt="" class="img_left" width="172"></a>Les débuts de Justin.tv ne sont pas banals. Le site a en effet commencé par diffuser la vie de son fondateur, Justin Kan, qui portait une webcam sur sa tête 24h/24&nbsp;! Ce concept, le "lifecasting", n'était pas vraiment nouveau&nbsp;; cependant, le succès fut cette fois au rendez-vous. Justin.tv s'est rapidement ouvert à d'autres utilisateurs désireux de diffuser leur vie en direct sur le Web, histoire de connaître le fameux "quart d'heure de célébrité" warholien. Après plusieurs mois de <span class="lexique beta actif">bêta</span>, le site devint finalement accessible à tous, fin 2007. Des milliers de chaînes furent rapidement créées. Devant ce succès, d'autres acteurs se sont engouffrés dans la brèche. Citons notamment Ustream, qui possède lui aussi une histoire peu banale, puisque le site fut au départ créé pour permettre aux soldats envoyés en Irak de garder le contact avec leur famille&nbsp;! Mais comme Justin.tv, Ustream s'est rapidement ouvert à tous. <strong>Ces deux sites restent toutefois des généralistes&nbsp;: on y trouve des directs consacrés aux jeux vidéo, bien sûr, mais aussi des canaux musicaux ou animaliers... La place était donc vacante pour des sites plus spécialisés, uniquement consacrés à la diffusion de parties commentées</strong>.</p>
            <p><a href="http://www.jeuxvideo.com/screenshots/dossiers/images/00017381/00017381_00000005_000.htm" target="_blank"><img src="http://image.jeuxvideo.com/imd/o/own3dtv_logo_m.jpg" alt="" class="img_left" width="172"></a>Lancée en 2010, own3D.tv fut donc la première plate-forme de <span class="lexique streaming actif">streaming</span> live totalement dédiée aux jeux vidéo. La compagnie est basée en Autriche, un positionnement géographique qu'elle estime idéal car central, entre Amérique et Asie. Et force est de constater qu'<strong>own3D.tv a rapidement su s'imposer comme un acteur incontournable dans le streaming live d'événements e-sport d'envergure mondiale</strong>. En 2011, le site a ainsi été choisi pour diffuser la QuakeCon, grand-messe d'id Software, l'European Battle.net Invitational de Blizzard, la finale de l'Electronic Sport World Cup, etc. Mais own3D.tv ne se contente pas de proposer ses services aux organisateurs de compétitions. Le site permet aussi à tout un chacun de diffuser ses parties quotidiennes. Certains pro-gamers ont alors saisi cette occasion de jouer en direct commenté, y trouvant un bon moyen d'être en contact avec leur communauté (et de gagner un complément de revenu, nous y reviendrons). A l'heure où nous écrivons ces lignes, Destiny, joueur notoire de StarCraft II, réunit plus de 2.000 personnes devant son livestream propulsé par own3D.tv. Mais la plate-forme autrichienne doit aujourd'hui faire face à la concurrence d'un nouvel acteur...</p>
            -->

            <p>
                <strong>Lorem ipsum</strong> dolor sit amet, consectetur adipiscing elit. 
                Phasellus condimentum velit ut lectus congue sed ornare velit sagittis. Pellentesque at pulvinar est. 
                Quisque ut accumsan lorem. Fusce congue auctor venenatis. Nullam interdum ultrices fringilla. 
                Morbi posuere, arcu at placerat <a>luctus</a>, sapien magna dapibus lectus, sit amet congue sapien nisl nec quam. Vestibulum ut facilisis leo. 
                Praesent lobortis, est at adipiscing fringilla, purus lacus commodo nibh, ac sagittis velit sapien vel metus. Pellentesque mollis, magna at feugiat egestas, ligula justo viverra lorem, at consectetur nisi elit nec purus. Duis quis orci in magna sodales ultrices. Quisque odio purus, euismod sed scelerisque euismod, iaculis sit amet tellus. Donec id commodo nibh. Phasellus pulvinar scelerisque elementum. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. 
                Morbi eget erat imperdiet nulla sodales ultricies. Aenean enim nisl, pharetra quis dapibus eget, faucibus et lorem.
            </p>

            <p>Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.
                Proin nisl urna, iaculis non tincidunt nec, imperdiet quis lorem.
                Pellentesque eu diam in purus vehicula malesuada sit amet id nibh. Fusce mi neque, feugiat eu mattis nec, rutrum at odio.
                Curabitur odio felis, congue ut gravida quis, luctus sed lacus. Proin non dui lacus, nec faucibus neque.
                Vivamus augue libero, ultrices sed porttitor in, porta eu ipsum. Fusce sit amet turpis ac ante malesuada eleifend in et turpis.
                Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. In id mi odio, nec hendrerit dui.
                Cras lacinia bibendum lectus porttitor fringilla. Morbi a diam et nibh euismod scelerisque ut ac turpis.
                Maecenas rhoncus, eros ac laoreet malesuada, nibh ligula suscipit purus, faucibus laoreet enim nisl in nunc.
                Nunc aliquam diam vitae magna iaculis vestibulum. Proin quis erat urna, venenatis feugiat mauris.
            </p>

            <p>Aliquam diam arcu, dignissim et tincidunt sed, condimentum et turpis. Nulla eros tellus, convallis vel ultrices non, tristique sit amet risus. Donec non dolor odio. Etiam eu lorem sed justo iaculis vehicula. Donec consequat, neque sit amet pharetra vulputate, diam enim luctus arcu, vel elementum risus metus in felis. Ut blandit interdum turpis, a ultrices mi porttitor ut. Maecenas iaculis accumsan commodo. Integer commodo quam vitae sem vulputate commodo. In molestie dolor tortor, a imperdiet libero.</p>

            <p>Ut hendrerit, felis a hendrerit lobortis, dui sem rutrum odio, et imperdiet dui elit ac eros. Nunc feugiat eros vitae enim auctor gravida. Morbi eget mi et nulla tristique viverra. Aenean lorem est, blandit nec placerat sit amet, ullamcorper a turpis. Ut iaculis turpis at nisl rutrum non iaculis mi feugiat. Sed ut vestibulum neque. Suspendisse id vehicula erat. Etiam dapibus luctus nisi ut molestie. Nunc facilisis turpis sit amet urna fringilla tincidunt. In ac velit arcu. Integer viverra nisi et massa tempor placerat. Mauris ornare, arcu vitae sodales malesuada, elit lorem porttitor ligula, egestas vestibulum quam nisl quis augue. Donec at sem nisl. Ut vitae orci lacus, a suscipit erat. Praesent lobortis magna condimentum ipsum sollicitudin ut ullamcorper nunc accumsan.</p>

            <p>Nullam urna massa, suscipit at cursus in, imperdiet id dui. Phasellus semper pharetra euismod. Phasellus tortor justo, vulputate ac ultricies nec, cursus id sapien. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Praesent posuere molestie orci quis ornare. Donec eget sapien turpis. Phasellus euismod, elit nec fringilla pulvinar, neque metus laoreet eros, eu adipiscing orci risus in turpis. Nam ultrices, est eget gravida elementum, nisi lectus interdum justo, nec vulputate augue tortor nec est. Nunc odio purus, venenatis vitae euismod eu, lobortis at ligula. Fusce nec risus accumsan arcu luctus commodo non et ipsum. Vivamus erat magna, consectetur id adipiscing id, sollicitudin a diam.</p>

            <ul id="pointer">
                <li>element 1</li>
                <li>element 2</li>
                <li>element 3</li>
                <li>element 4</li>
                <li>element 5</li>
                <li>element 6</li>
            </ul>

            <!-- popup du formulaire d'annotation -->
            <div class="boxes">
                <div class="window">
                    <form class="annotForm">
                        <label>Message : </label>
                        <textarea name="message" data-minlength="20"></textarea><br />
                        <button class="btn" id="annotBtn" >Envoyer</button>
                    </form>
                </div>
                <div class="mask"></div>
            </div>

        </div>

        <!-- Div contenant le menu contextuel du plugin -->
        <div class="wrapMyMenu">
            <ul id="myMenu" class="contextMenu">
                <li class="annoter">
                    <a href="#annoter">annoter</a>
                </li>
            </ul>
        </div>
        <script>
            $(document).ready(function(){
                
                /*
                 *
                 *popup
                 *
                 **/
                
                boxes = {
                    // hauteur/largeur de la fenetre
                    windowWidth: function(){
                        if(window.innerWidth)return window.innerWidth;
                        else {return $(window).width;}
                    },
                    windowHeight: function(){
                        if(window.innerHeight)return window.innerHeight;
                        else {return $(window).height;}
                    }
                }
                
               
                
                //setInterval(function(){}, x) permet de lancer une fonction tout les x ms
                setInterval(function(){
                    //recuperation de la selection en cours
                    var selection = window.getSelection();
                    
                    
                    if(selection.toString().length > 0)
                    {
                        //active le menu contextuel du browser
                        $('.container').add($('UL.contextMenu')).bind('contextmenu', function() { return false; });
                        //active le menu contextuel du plugin
                        $('.container').enableContextMenu();
                        
                        //application du plugin sur la class contenant la ressource a annoter (ici container)
                        $(".container").contextMenu({
                            menu: 'myMenu'
                        },
                        function() {
                            //afficher un formulaire discret...
                            //Get the screen height and width
                            var maskHeight = $(document).height();
                            var maskWidth = $(document).width();

                            //le mask occupe tout l'ecran
                            $(".mask").css({"width":maskWidth,"height":maskHeight});

                            //affichage du popup
                            $(".mask").fadeTo("slow",0.5);
                            $(".window").fadeTo("slow", 1);
                            $(".annotForm").show();
                        
                            //hauteur/largeur du formulaire
                            var $windowH = $(".window").height();
                            var $windowW = $(".window").width() + 40; // + 40 car il y a 20px de padding sur la box .window

                            var x = (boxes.windowWidth() / 2) - ($windowW / 2);
                            var y = (boxes.windowHeight() / 2) - ($windowH / 2);

                            $(".window").css("left", x +'px');
                            $(".window").css("top", y +'px');

                            //masque le popup quand on click en dehors du formulaire
                            $(".mask").click(function(){
                                $(".mask, .annotForm").hide();
                                $(".window").hide();
                            });
                            
                            
                            /*
                             *
                             *XPOINTER
                             *
                             *
                             **/
                            
                            //Browser spécifique
                            //mozilla
                            //if($.browser.mozilla)
                            //{
                                //recuperation de l'url de la page
                                //var pathname = window.location.pathname;
                                var currentUrl = window.location;
                                var xpointerStart;
                                var xpointerEnd;
                        
                                //Noeuds du début et de la fin de la selection
                                var start_node = selection.anchorNode;//selection.startContainer;
                                var end_node = selection.focusNode;//selection.endContainer;
				alert(start_node);
                                
                                //Le nombre de caractere entre le noeud pere et le debut/fin de la selection
                                var start_offset = selection.anchorOffset; // NE TIENT PAS COMPTE DES CARACTERES HTML PRESENTS AVANT LA SELECTION JUSQU'AU NOEUD PERE
                                var end_offset = selection.focusOffset;
                                
                                var trueStartNode = start_node ;
                                var trueEndNode = end_node;
                            
                                /*Firefox ajoute des noeuds text pour entourer du texte, quand le noeud pere est du type text, 
                                 *on reccupere le pere du noeud text
                                 **/
                                if(start_node.nodeType == 3)
                                {
                                    trueStartNode = start_node.parentNode ;
                                }
                                if(end_node.nodeType == 3)
                                {
                                    trueEndNode = end_node.parentNode;
                                }
                                
                                //echange trueStartNode et trueEndNode quand le cas ou on fait une selection inversé (on commence de la fin)
                                //cas ou le noeud de depart precede le noeud d'arrive
                                //ou bien le noeud de depart est contenu dans le noeud d'arrive 
                                if(trueStartNode.compareDocumentPosition(trueEndNode) == 2 || 
                                    trueStartNode.compareDocumentPosition(trueEndNode) == 10)
                                {
                                    var tmp = trueStartNode;
                                    trueStartNode = trueEndNode;
                                    trueEndNode = tmp;
                                
                                    tmp = start_offset;
                                    start_offset = end_offset;
                                    end_offset = tmp;
                                }
                                //cas ou on fait une selection inversé dans une meme balise
                                else if(trueStartNode.compareDocumentPosition(trueEndNode) == 0 && start_offset > end_offset)
                                {
                                    var tmp = start_offset;
                                    start_offset = end_offset;
                                    end_offset = tmp;
                                }
                                
                                xpointerStart = makeXpointer(currentUrl, trueStartNode, start_offset);
                                xpointerEnd = makeXpointer(currentUrl, trueEndNode, end_offset);
                                //alert("start node: "+trueStartNode.nodeName);
                                //alert("end node: "+trueEndNode.nodeName);
                                //alert("start offset: "+start_offset);
                                //alert("end offset: "+end_offset);
                                alert(xpointerStart);
                                alert(xpointerEnd);
                                    
                                /*
                                 *
                                 *COLORATION
                                 **/
                                //$("#annotBtn").click(function(){
                                //var idS = coloration(xpointerStart, xpointerEnd);
                                var selectorAndIndiceCharStart = splitXpointer(xpointerStart);
                                var selectorAndIndiceCharEnd = splitXpointer(xpointerEnd);
                                //pourquoi tu memorises les anciens idS ??????
                                coloration(selectorAndIndiceCharStart, selectorAndIndiceCharEnd);
                                
                                //return false;
                                //});
                            //}
                            //TODO others 
                            
                            
                            /*
                             *
                             *Format d'un xPointer: 
                             *url_courant#xpointer(id('idNoeudPere')/chemin/des/peres, nbCaractereEntreNoeudEtSelection)
                             *ou si on ne trouve pas d'id de reference:
                             *url_courant#xpointer(body/chemin/des/peres, nbCaractereEntreNoeudEtSelection)
                             *
                             **/
                            
                            //parametre: url courrant, node de depart pour le calcul du xpointer et le offset (nb caractere entre node et le debut de la selection)
                            function makeXpointer(url, node, offset)
                            {
                                var xpointer = url+"#xpointer(";
                                var idNode = -1;
                                var path = "";
                                var nbPreviousSiblings = 0;
                                var previousNode;
                                
                                //tant qu'on ne trouve pas de noeud avec un id
                                while(idNode == "" || idNode == -1)
                                {
                                    previousNode = node;
                                    //calcul de la position du noeud actuel par rapport a son pere
                                    nbPreviousSiblings = $(previousNode).prevAll().length;
                                    path = "/" + nbPreviousSiblings + path;
                                    node = previousNode.parentNode;
                                    
                                    //si le noeud actuel est la balise body on break la boucle car on est arrivé au bout sans trouver d'id
                                    if(node.nodeName == 'BODY')
                                        break;
                                    idNode = node.id;
                                }
                                if(node.nodeName == 'BODY')
                                {
                                    xpointer = xpointer + "body"
                                }
                                else
                                {
                                    xpointer = xpointer + "id(\"" + idNode + "\")";
                                }
                                xpointer = xpointer + path + "," + offset + ")";
                                return xpointer;
                            }
                            
                            /*function trueOffset(html, indice)
                            {
                                //alert("indice: "+ indice);
                                var compteur = 0;
                                var nb = 0;
                                var nbCarac = 0;
                                while(compteur < html.length)
                                {
                                    if(html[compteur] == '<')
                                    {
                                        while(html[compteur] != '>')
                                        {
                                            alert(html[compteur]);
                                            nbCarac = nbCarac + 1;
                                            compteur = compteur + 1;
                                        }
                                        nbCarac = nbCarac + 1;
                                    }
                                    compteur = compteur + 1;
                                    nb = nb + 1;
                                }
                                alert("nb caractere en plus: "+nbCarac);
                            }*/
                            
                            function coloration(selector1, selector2)
                            {
                                //alert("select: "+selector1);
                                var $selectS = selector1.split('/')[0];
                                var $indiceCharS = parseInt(selector1.split('/')[1]);
                                
                                var $selectE = selector2.split('/')[0];
                                var $indiceCharE = parseInt(selector2.split('/')[1]);
                                
                                
                                var $codeStart = $("<span class=\"coloration\">");
                                var $codeEnd = $("</span>");
                                
                                //reccuperation du html contenu dans la balise ou la selection a été faite
                                var $content = $($selectS).html();
                                //alert("indice: "+$indiceCharS);
                                trueOffset($content, $indiceCharS);
                                
                                //calcul du nb de caracteres suplementaire entre le html et le text contenu dans la balise ou la selection a été faite
                                /*var longText = $($selectS).text().length;
                                var longHtml = $content.length;
                                var nbCaractereSup = longHtml - longText;
                                alert("longueur texte: "+longText+"\n longueur html: "+longHtml);
                                alert("nb caractere sup: "+nbCaractereSup);*/
                                
                                
                                //partage le html reccuperé en 3 partie, la partie 2 correspondant au texte selectionné
                                //on entoure la partie 2 de balise span avec la classe coloration
                                var part2 = $content.substring($indiceCharS, $indiceCharE);
                                var part1 = $content.substring(0, $indiceCharS);
                                var part3 = $content.substring($indiceCharE, $content.length);
                                part2 = "<span class=\"coloration\">"+part2+"</span>";
                                
                                //concatenation des differentes parties
                                var newContent = part1+part2+part3;
                                
                                //on supprime l'ancien html
                                $($selectS).empty();
                                //et on le remplace par le nouveau, cad avec la balise span
                                $($selectS).html(newContent);
                            }
                            
                            //permet de spliter un xpointer pour récuperer les elements qu'on a besoin pour la coloration
                            //cad le path en jquery et le offset
                            function splitXpointer(xpointer)
                            {
                                //pathStart vaut id ou boby/...)
                                var pathStart = xpointer.split('(')[1];
                                var idStart = '';
                                
                                //si le xpointer contient un id
                                //on le split de sort a recuperer le nom de l'id qu'on concatene avec un '#'
                                //dans tout les cas on recupere le pathStart qui correspond une chaine du genre /1/1/2,36
                                if(pathStart == 'id'){
                                    pathStart = xpointer.split(')')[1];
                                    idStart = "#"+xpointer.split('"')[1];
                                    //sinon idStart = body
                                }else{
                                    pathStart = xpointer.split('(')[1].split(')')[0];
                                    idStart = pathStart.split('/')[0];
                                    pathStart = pathStart.split(idStart)[1];
                                }
                                //recuperation de l'offset, partie après la virgule du pathStart
                                var indiceCharStart = pathStart.split(',')[1];
                                /*recuperation de la partie path, chemin du noeud correspondant au debut de la selection
                                 *jusqu'au noeud possedant un id (ou jusqu'au noeud body) exclus (exemple /0/1/1/0) */
                                pathStart = pathStart.split(',')[0];
                                //tab contient les numeros des places des peres dans le DOM par rapport a l'id (ou body)
                                //puis par rapport au pere precedant ainsi de suite...
                                var tab = pathStart.split('/');
                                
                                //tmp va contenir le chemin jquery du noeud contenant l'id (ou body) exclus 
                                //jusqu'au noeud ou commence la selection
                                var tmp = '';
                                for(var i = 1; i < tab.length; i++){
                                    var num = parseInt(tab[i], 10) + 1;
                                    // :nth-child(x) renvoye un tableau des noeuds fils du selecteur courant, du x eme fils au dernier
                                    // :eq(0) pour reccupere le premier element du tableau des fils.
                                    tmp = tmp + " :nth-child("+num+") :eq("+0+")";
                                }
                                
                                
                                return idStart+tmp+'/'+indiceCharStart;
                            }
                            
                            
                        }); //fin fonction plugin
                    }
                    else{
                        //reactive le menu contextuel du browser
                        $('.container').add($('UL.contextMenu')).unbind('contextmenu');
                        //desactive le menu contextuel du plugin
                        $('.container').disableContextMenu();
                    }
                }, 500);
                
                
            });
        </script>
    </body>
</html>
